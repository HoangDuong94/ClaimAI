<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:l="sap.ui.layout">
    <Popover
        id="aiChatPopoverControl"
        title="AI Chat Assistant"
        placement="Auto"
        contentWidth="400px"
        contentHeight="350px"
        resizable="true"
        showHeader="true"> <!-- showHeader=true, damit der Titel angezeigt wird -->
        <!-- initialFocus="chatInputInPopover" --> <!-- Optional: Fokus auf Eingabefeld setzen -->
        <content>
            <VBox fitContainer="true" justifyContent="SpaceBetween" height="100%">
                <ScrollContainer
                    height="calc(100% - 60px)"
                    width="100%"
                    horizontal="false"
                    vertical="true"
                    class="sapUiSmallMarginTopBottom">
                    <List
                        id="chatHistoryListInPopover"
                        items="{chat>/chatHistory}"
                        showSeparators="None"
                        class="sapUiSmallMarginBeginEnd">
                        <CustomListItem>
                            <HBox class="sapUiSmallMarginBeginEnd sapUiTinyMarginTopBottom"
                                  justifyContent="{= ${chat>type} === 'user' ? 'End' : 'Start' }">
                                <VBox>
                                    <Text text="{chat>text}" class="sapUiSmallMarginBottom"
                                          wrapping="true"
                                          width="auto"
                                          textAlign="{= ${chat>type} === 'user' ? 'End' : 'Start' }" />
                                    <Label text="{= ${chat>type} === 'user' ? 'You' : 'Assistant' }"
                                           design="{= ${chat>type} === 'user' ? 'Bold' : 'Standard' }"
                                           class="sapUiTinyMarginBottom"/>
                                </VBox>
                            </HBox>
                        </CustomListItem>
                    </List>
                </ScrollContainer>
                <Bar>
                    <contentMiddle>
                        <Input
                            id="chatInputInPopover"
                            value="{chat>/userInput}"
                            placeholder="Type your message..."
                            width="100%"
                            submit=".onSendChatMessageInPopover"/> <!-- Methode im Fragment-Controller -->
                    </contentMiddle>
                    <contentRight>
                        <Button icon="sap-icon://paper-plane" press=".onSendChatMessageInPopover" tooltip="Send"/>
                    </contentRight>
                </Bar>
            </VBox>
        </content>
        <!-- Popover haben typischerweise keine expliziten Schließen-Buttons im Footer,
             sie schließen durch Klick außerhalb oder ESC.
             Man könnte aber einen hinzufügen, wenn gewünscht. -->
        <!-- <endButton>
            <Button text="Close" press="onClosePopoverSomehow" />
        </endButton> -->
    </Popover>
</core:FragmentDefinition>